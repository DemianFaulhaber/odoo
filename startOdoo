#!/bin/bash

# Odoo Startup Script
# This script activates venv, kills any existing Odoo processes, and starts Odoo in development mode

# Get the script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
VENV_PATH="$SCRIPT_DIR/venv"

echo "🔄 Stopping any existing Odoo processes..."
pkill -f odoo-bin

# Wait a moment for processes to stop
sleep 2

echo "🌟 Activating virtual environment..."
if [ -f "$VENV_PATH/bin/activate" ]; then
    source "$VENV_PATH/bin/activate"
    echo "✅ Virtual environment activated: $(which python)"
    echo "📦 Python version: $(python --version)"
    PYTHON_EXEC="$VENV_PATH/bin/python"
else
    echo "⚠️  Virtual environment not found at $VENV_PATH"
    echo "📝 Using system Python: $(which python)"
    PYTHON_EXEC="python3"
fi

echo "🚀 Starting Odoo in development mode..."
echo "📂 Working directory: $(pwd)"
echo "🌐 Odoo will be available at: http://localhost:8069"
echo "⚠️  Press Ctrl+C to stop Odoo"
echo ""

# Change to script directory and start Odoo with development mode
cd "$SCRIPT_DIR"

# Use the Python executable from venv to ensure all dependencies are available
if [ -f "$VENV_PATH/bin/activate" ]; then
    echo "🚀 Starting Odoo with virtual environment Python..."
    "$PYTHON_EXEC" ./odoo-bin -c odoo.conf --dev=all
else
    echo "🚀 Starting Odoo with system Python..."
    python3 ./odoo-bin -c odoo.conf --dev=all
fi
